<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create-Cesium üåè</title>
    <script type="module" src="/src/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
    <style>
      #cesiumContainer {
        width: 100%;
        height: 100vh;
      }
      .dg.main {
        position: absolute;
        top: 10px;
        right: 200px;
        z-index: 1000;
      }
      .draw-control {
        position: absolute;
        top: 10px;
        right: 10px;
        background: white;
        padding: 5px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 1000;
      }
      .draw-control button {
        display: block;
        width: 100%;
        margin: 2px 0;
        padding: 5px 10px;
        border: none;
        background: #4CAF50;
        color: white;
        border-radius: 3px;
        cursor: pointer;
      }
      .draw-control button:hover {
        background: #45a049;
      }
      .draw-control button.active {
        background: #f44336;
      }
      .measure-control {
        position: absolute;
        top: 150px;
        right: 10px;
        background: white;
        padding: 5px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        z-index: 1000;
      }
      .measure-control button {
        display: block;
        width: 100%;
        margin: 2px 0;
        padding: 5px 10px;
        border: none;
        background: #2196F3;
        color: white;
        border-radius: 3px;
        cursor: pointer;
      }
      .measure-control button:hover {
        background: #1976D2;
      }
      .measure-control button.active {
        background: #f44336;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer"></div>
    <div class="draw-control">
      <button id="drawPoint" title="ÁªòÂà∂ÁÇπ">ÁÇπ</button>
      <button id="drawLine" title="ÁªòÂà∂Á∫ø">Á∫ø</button>
      <button id="drawPolygon" title="ÁªòÂà∂Èù¢">Èù¢</button>
      <button id="clearDraw" title="Ê∏ÖÈô§ÁªòÂà∂">Ê∏ÖÈô§</button>
    </div>
    <div class="measure-control">
      <button id="measureDistance" title="ÊµãË∑ù">ÊµãË∑ù</button>
      <button id="measureArea" title="ÊµãÈù¢">ÊµãÈù¢</button>
      <button id="clearMeasure" title="Ê∏ÖÈô§ÊµãÈáè">Ê∏ÖÈô§</button>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const cesiumLite = new CesiumLite('cesiumContainer', {
          map: {
            baseMap: {
              id: 'imagery'
            },
            camera: {
              longitude: 116.397428,
              latitude: 39.90923,
              height: 1000000,
              heading: 0,
              pitch: -90,
              roll: 0
            }
          }
        });

        const gui = new dat.GUI();
        
        const cameraParams = {
          longitude: 116.397428,
          latitude: 39.90923,
          height: 1000000,
          heading: 0,
          pitch: -90,
          roll: 0,
          flyTo: () => {
            cesiumLite.cameraControl.flyTo({
              longitude: cameraParams.longitude,
              latitude: cameraParams.latitude,
              height: cameraParams.height,
              heading: cameraParams.heading,
              pitch: cameraParams.pitch,
              roll: cameraParams.roll,
              duration: 2
            });
          },
          setView: () => {
            cesiumLite.cameraControl.setView({
              longitude: cameraParams.longitude,
              latitude: cameraParams.latitude,
              height: cameraParams.height,
              heading: cameraParams.heading,
              pitch: cameraParams.pitch,
              roll: cameraParams.roll
            });
          }
        };

        gui.add(cameraParams, 'longitude', -180, 180).name('ÁªèÂ∫¶');
        gui.add(cameraParams, 'latitude', -90, 90).name('Á∫¨Â∫¶');
        gui.add(cameraParams, 'height', 1000, 2000000).name('È´òÂ∫¶');
        gui.add(cameraParams, 'heading', -180, 180).name('ÊñπÂêëËßí');
        gui.add(cameraParams, 'pitch', -90, 90).name('‰øØ‰ª∞Ëßí');
        gui.add(cameraParams, 'roll', -180, 180).name('ÁøªÊªöËßí');
        gui.add(cameraParams, 'flyTo').name('È£ûË°åÂà∞ÊåáÂÆöËßÜËßí');
        gui.add(cameraParams, 'setView').name('ËÆæÁΩÆËßÜËßí');

        const basemapFolder = gui.addFolder('Â∫ïÂõæÂàáÊç¢');
        const basemapParams = {
          imagery: () => cesiumLite.basemapControl.switchBasemap('imagery'),
          gaode: () => cesiumLite.basemapControl.switchBasemap('gaode'),
          osm: () => cesiumLite.basemapControl.switchBasemap('osm')
        };
        basemapFolder.add(basemapParams, 'imagery').name('ÂΩ±ÂÉèÂú∞Âõæ');
        basemapFolder.add(basemapParams, 'gaode').name('È´òÂæ∑Âú∞Âõæ');
        basemapFolder.add(basemapParams, 'osm').name('OSMÂú∞Âõæ');

        const alphaFolder = gui.addFolder('Â∫ïÂõæÈÄèÊòéÂ∫¶');
        const alphaParams = {
          alpha: 1.0,
          setAlpha: () => {
            const currentBasemap = cesiumLite.basemapControl.getCurrentBasemap();
            if (currentBasemap) {
              cesiumLite.basemapControl.setBasemapAlpha(currentBasemap.id, alphaParams.alpha);
            }
          }
        };
        alphaFolder.add(alphaParams, 'alpha', 0, 1).name('ÈÄèÊòéÂ∫¶');
        alphaFolder.add(alphaParams, 'setAlpha').name('Â∫îÁî®ÈÄèÊòéÂ∫¶');

        // ÁªòÂà∂Êéß‰ª∂ÊåâÈíÆ‰∫ã‰ª∂
        const drawButtons = {
          drawPoint: document.getElementById('drawPoint'),
          drawLine: document.getElementById('drawLine'),
          drawPolygon: document.getElementById('drawPolygon'),
          clearDraw: document.getElementById('clearDraw')
        };

        // ÊµãÈáèÊéß‰ª∂ÊåâÈíÆ‰∫ã‰ª∂
        const measureButtons = {
          measureDistance: document.getElementById('measureDistance'),
          measureArea: document.getElementById('measureArea'),
          clearMeasure: document.getElementById('clearMeasure')
        };

        // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁä∂ÊÄÅ
        function removeActiveState() {
          Object.values(drawButtons).forEach(button => {
            button.classList.remove('active');
          });
          Object.values(measureButtons).forEach(button => {
            button.classList.remove('active');
          });
        }

        function getDrawData(data) {
          console.log(data.polygon.hierarchy.getValue().positions);
        }

        // ÁªòÂà∂ÁÇπ
        drawButtons.drawPoint.addEventListener('click', () => {
          removeActiveState();
          drawButtons.drawPoint.classList.add('active');
          cesiumLite.drawTool.draw('Point', getDrawData);
        });

        // ÁªòÂà∂Á∫ø
        drawButtons.drawLine.addEventListener('click', () => {
          removeActiveState();
          drawButtons.drawLine.classList.add('active');
          cesiumLite.drawTool.draw('Polyline', getDrawData);
        });

        // ÁªòÂà∂Èù¢
        drawButtons.drawPolygon.addEventListener('click', () => {
          removeActiveState();
          drawButtons.drawPolygon.classList.add('active');
          cesiumLite.drawTool.draw('Polygon', getDrawData);
        });

        // Ê∏ÖÈô§ÁªòÂà∂
        drawButtons.clearDraw.addEventListener('click', () => {
          removeActiveState();
          cesiumLite.drawTool.clearAll();
        });

        // ÊµãË∑ù
        measureButtons.measureDistance.addEventListener('click', () => {
          removeActiveState();
          measureButtons.measureDistance.classList.add('active');
          cesiumLite.measureTool.measureDistance((result) => {
            console.log('ÊµãÈáèË∑ùÁ¶ª:', result.distance, 'ÂÖ¨Èáå');
          });
        });

        // ÊµãÈù¢
        measureButtons.measureArea.addEventListener('click', () => {
          removeActiveState();
          measureButtons.measureArea.classList.add('active');
          cesiumLite.measureTool.measureArea((result) => {
            console.log('ÊµãÈáèÈù¢ÁßØ:', result.area, 'Âπ≥ÊñπÂÖ¨Èáå');
          });
        });

        // Ê∏ÖÈô§ÊµãÈáè
        measureButtons.clearMeasure.addEventListener('click', () => {
          removeActiveState();
          cesiumLite.measureTool.clearAll();
        });
      });
    </script>
  </body>
</html>
